<!DOCTYPE html>
<html dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Music Downloader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        body:lang(ar) {
            font-family: 'Tajawal', sans-serif;
        }
        .loader {
            border-top-color: #3498db;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .lang-switcher-container {
            position: absolute;
            top: 1rem;
            right: 1rem;
            z-index: 10;
        }
        .lang-switcher-container select {
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            border: 1px solid #4A5568;
            background-color: #2D3748;
            color: white;
            font-size: 0.875rem;
        }
        #statusArea ul::-webkit-scrollbar {
            width: 8px;
        }
        #statusArea ul::-webkit-scrollbar-track {
            background: #2D3748;
            border-radius: 10px;
        }
        #statusArea ul::-webkit-scrollbar-thumb {
            background: #4A5568;
            border-radius: 10px;
        }
        #statusArea ul::-webkit-scrollbar-thumb:hover {
            background: #718096;
        }
    </style>
</head>
<body class="bg-gradient-to-r from-slate-900 to-slate-700 text-white min-h-screen flex flex-col items-center justify-center p-4 selection:bg-sky-500 selection:text-white">

    <div class="lang-switcher-container">
        <label for="languageSelector" class="sr-only" data-translate-key="languageLabel">Language:</label>
        <select id="languageSelector" title="Select Language">
            <option value="en">English</option>
            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            <option value="es">Espa√±ol</option>
            <option value="az">Az…ôrbaycanca</option>
            <option value="tr">T√ºrk√ße</option>
            <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
        </select>
    </div>

    <div class="bg-slate-800 p-6 sm:p-8 rounded-xl shadow-2xl w-full max-w-lg">
        <div class="text-center mb-6 sm:mb-8">
            <h1 data-translate-key="headerH1" class="text-3xl sm:text-4xl font-bold text-sky-400">Music Downloader üé∂</h1>
            <p data-translate-key="headerP" class="text-slate-400 mt-2">Paste a YouTube video or playlist link</p>
        </div>

        <form id="downloadForm" class="space-y-6">
            <div>
                <label for="youtube_url" data-translate-key="urlLabel" class="block text-sm font-medium text-slate-300 mb-1">YouTube Link:</label>
                <input type="url" id="youtube_url" name="youtube_url" required
                       class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-500 focus:ring-sky-500 focus:border-sky-500 transition duration-150"
                       data-translate-placeholder="urlPlaceholder"
                       placeholder="https://www.youtube.com/watch?v=...">
            </div>

            <div>
                <label for="format_choice" data-translate-key="formatLabel" class="block text-sm font-medium text-slate-300 mb-1">Select format:</label>
                <select id="format_choice" name="format_choice"
                        class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:ring-sky-500 focus:border-sky-500 transition duration-150">
                    <option value="mp3" selected data-translate-key="formatMp3">MP3 (recommended)</option>
                    <option value="wav" data-translate-key="formatWav">WAV (uncompressed, larger size)</option>
                </select>
            </div>

            <button type="submit" data-translate-key="submitButton"
                    class="w-full bg-sky-500 hover:bg-sky-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-opacity-50">
                Download Audio
            </button>
        </form>

        <div id="statusArea" class="mt-6 text-center min-h-[50px]">
            </div>
    </div>

    <footer class="text-center mt-8 text-slate-500 text-sm">
        <p>¬© <span id="year"></span> <span data-translate-key="footerCopyrightText">YouTube Music downloader. Site made by BitSamurai.</span></p>
    </footer>

    <script>
        const translations = {
            en: {
                pageTitle: "YouTube Music Downloader",
                headerH1: "Music Downloader üé∂",
                headerP: "Paste a YouTube video or playlist link",
                urlLabel: "YouTube Link:",
                urlPlaceholder: "https://www.youtube.com/watch?v=...",
                formatLabel: "Select format:",
                formatMp3: "MP3 (recommended)",
                formatWav: "WAV (uncompressed, larger size)",
                submitButton: "Download Audio",
                footerCopyrightText: "YouTube Music downloader. Site made by BitSamurai.",
                statusErrorUrl: "Please enter a URL.",
                statusProcessing: "Processing link... Please wait.",
                statusSuccessHeader: "Done! File(s) ready:",
                statusDownloadButton: "Download {FORMAT}",
                statusPostDownloadHint: "If the download didn't start, check your browser settings or try right-clicking and 'Save link as...'.",
                statusErrorGeneric: "Error: {MESSAGE}",
                statusNetworkError: "A network error occurred. Please try again.",
                languageLabel: "Language:"
            },
            ru: {
                pageTitle: "–ó–∞–≥—Ä—É–∑—á–∏–∫ –ú—É–∑—ã–∫–∏ —Å YouTube",
                headerH1: "–ó–∞–≥—Ä—É–∑—á–∏–∫ –ú—É–∑—ã–∫–∏ üé∂",
                headerP: "–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube –≤–∏–¥–µ–æ –∏–ª–∏ –ø–ª–µ–π–ª–∏—Å—Ç",
                urlLabel: "–°—Å—ã–ª–∫–∞ YouTube:",
                urlPlaceholder: "https://www.youtube.com/watch?v=...",
                formatLabel: "–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç:",
                formatMp3: "MP3 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)",
                formatWav: "WAV (–±–µ–∑ —Å–∂–∞—Ç–∏—è, –±–æ–ª—å—à–µ —Ä–∞–∑–º–µ—Ä)",
                submitButton: "–°–∫–∞—á–∞—Ç—å –ê—É–¥–∏–æ",
                footerCopyrightText: "–ó–∞–≥—Ä—É–∑—á–∏–∫ –º—É–∑—ã–∫–∏ YouTube. –°–∞–π—Ç —Å–¥–µ–ª–∞–Ω BitSamurai.",
                statusErrorUrl: "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ URL.",
                statusProcessing: "–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Å—ã–ª–∫–∏... –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ.",
                statusSuccessHeader: "–ì–æ—Ç–æ–≤–æ! –§–∞–π–ª(—ã) –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:",
                statusDownloadButton: "–°–∫–∞—á–∞—Ç—å {FORMAT}",
                statusPostDownloadHint: "–ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ –Ω–∞—á–∞–ª–∞—Å—å, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∫–ª–∏–∫–Ω—É—Ç—å –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏ –∏ \"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Å—ã–ª–∫—É –∫–∞–∫...\".",
                statusErrorGeneric: "–û—à–∏–±–∫–∞: {MESSAGE}",
                statusNetworkError: "–ü—Ä–æ–∏–∑–æ—à–ª–∞ —Å–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.",
                languageLabel: "–Ø–∑—ã–∫:"
            },
            es: {
                pageTitle: "Descargador de M√∫sica de YouTube",
                headerH1: "Descargador de M√∫sica üé∂",
                headerP: "Pega un enlace de video o lista de reproducci√≥n de YouTube",
                urlLabel: "Enlace de YouTube:",
                urlPlaceholder: "https://www.youtube.com/watch?v=...",
                formatLabel: "Seleccionar formato:",
                formatMp3: "MP3 (recomendado)",
                formatWav: "WAV (sin comprimir, tama√±o mayor)",
                submitButton: "Descargar Audio",
                footerCopyrightText: "Descargador de m√∫sica de YouTube. Sitio hecho por BitSamurai.",
                statusErrorUrl: "Por favor, introduce una URL.",
                statusProcessing: "Procesando enlace... Por favor, espera.",
                statusSuccessHeader: "¬°Listo! Archivo(s) listo(s):",
                statusDownloadButton: "Descargar {FORMAT}",
                statusPostDownloadHint: "Si la descarga no comenz√≥, revisa la configuraci√≥n de tu navegador o intenta hacer clic derecho y 'Guardar enlace como...'.",
                statusErrorGeneric: "Error: {MESSAGE}",
                statusNetworkError: "Ocurri√≥ un error de red. Por favor, int√©ntalo de nuevo.",
                languageLabel: "Idioma:"
            },
            az: {
                pageTitle: "YouTube Musiqi Y√ºkl…ôyicisi",
                headerH1: "Musiqi Y√ºkl…ôyicisi üé∂",
                headerP: "YouTube video v…ô ya pleylist ke√ßidini daxil edin",
                urlLabel: "YouTube Ke√ßidi:",
                urlPlaceholder: "https://www.youtube.com/watch?v=...",
                formatLabel: "Format se√ßin:",
                formatMp3: "MP3 (t√∂vsiy…ô olunur)",
                formatWav: "WAV (sƒ±xƒ±lmamƒ±≈ü, daha b√∂y√ºk √∂l√ß√º)",
                submitButton: "Audio Y√ºkl…ô",
                footerCopyrightText: "YouTube musiqi y√ºkl…ôyicisi. Sayt BitSamurai t…ôr…ôfind…ôn hazƒ±rlanƒ±b.",
                statusErrorUrl: "Z…ôhm…ôt olmasa, URL daxil edin.",
                statusProcessing: "Ke√ßid emal olunur... Z…ôhm…ôt olmasa, g√∂zl…ôyin.",
                statusSuccessHeader: "Hazƒ±rdƒ±r! Fayl(lar) y√ºkl…ônm…ôy…ô hazƒ±rdƒ±r:",
                statusDownloadButton: "{FORMAT} Y√ºkl…ô",
                statusPostDownloadHint: "∆èg…ôr y√ºkl…ôm…ô ba≈ülamadƒ±sa, brauzerinizin parametrl…ôrini yoxlayƒ±n v…ô ya saƒü klikl…ôyib 'Linki f…ôrqli saxla...' se√ßin.",
                statusErrorGeneric: "X…ôta: {MESSAGE}",
                statusNetworkError: "≈û…ôb…ôk…ô x…ôtasƒ± ba≈ü verdi. Z…ôhm…ôt olmasa, yenid…ôn c…ôhd edin.",
                languageLabel: "Dil:"
            },
            tr: {
                pageTitle: "YouTube M√ºzik ƒ∞ndirici",
                headerH1: "M√ºzik ƒ∞ndirici üé∂",
                headerP: "Bir YouTube video veya oynatma listesi baƒülantƒ±sƒ± yapƒ±≈ütƒ±rƒ±n",
                urlLabel: "YouTube Baƒülantƒ±sƒ±:",
                urlPlaceholder: "https://www.youtube.com/watch?v=...",
                formatLabel: "Format se√ßin:",
                formatMp3: "MP3 (√∂nerilir)",
                formatWav: "WAV (sƒ±kƒ±≈ütƒ±rƒ±lmamƒ±≈ü, daha b√ºy√ºk boyut)",
                submitButton: "Sesi ƒ∞ndir",
                footerCopyrightText: "YouTube m√ºzik indiricisi. Site BitSamurai tarafƒ±ndan yapƒ±ldƒ±.",
                statusErrorUrl: "L√ºtfen bir URL girin.",
                statusProcessing: "Baƒülantƒ± i≈üleniyor... L√ºtfen bekleyin.",
                statusSuccessHeader: "Tamamlandƒ±! Dosya(lar) hazƒ±r:",
                statusDownloadButton: "{FORMAT} ƒ∞ndir",
                statusPostDownloadHint: "ƒ∞ndirme ba≈ülamadƒ±ysa, tarayƒ±cƒ± ayarlarƒ±nƒ±zƒ± kontrol edin veya saƒü tƒ±klayƒ±p 'Baƒülantƒ±yƒ± farklƒ± kaydet...' se√ßeneƒüini deneyin.",
                statusErrorGeneric: "Hata: {MESSAGE}",
                statusNetworkError: "Bir aƒü hatasƒ± olu≈ütu. L√ºtfen tekrar deneyin.",
                languageLabel: "Dil:"
            },
            ar: {
                pageTitle: "ŸÖÿ≠ŸÖŸÑ ŸÖŸàÿ≥ŸäŸÇŸâ ŸäŸàÿ™ŸäŸàÿ®",
                headerH1: "ŸÖÿ≠ŸÖŸÑ ÿßŸÑŸÖŸàÿ≥ŸäŸÇŸâ üé∂",
                headerP: "ÿßŸÑÿµŸÇ ÿ±ÿßÿ®ÿ∑ ŸÅŸäÿØŸäŸà ŸäŸàÿ™ŸäŸàÿ® ÿ£Ÿà ŸÇÿßÿ¶ŸÖÿ© ÿ™ÿ¥ÿ∫ŸäŸÑ",
                urlLabel: "ÿ±ÿßÿ®ÿ∑ ŸäŸàÿ™ŸäŸàÿ®:",
                urlPlaceholder: "https://www.youtube.com/watch?v=...",
                formatLabel: "ÿßÿÆÿ™ÿ± ÿßŸÑÿµŸäÿ∫ÿ©:",
                formatMp3: "MP3 (ŸÖŸàÿµŸâ ÿ®Ÿá)",
                formatWav: "WAV (ÿ∫Ÿäÿ± ŸÖÿ∂ÿ∫Ÿàÿ∑ÿå ÿ≠ÿ¨ŸÖ ÿ£ŸÉÿ®ÿ±)",
                submitButton: "ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸàÿ™",
                footerCopyrightText: "ŸÖÿ≠ŸÖŸÑ ŸÖŸàÿ≥ŸäŸÇŸâ ŸäŸàÿ™ŸäŸàÿ®. ÿßŸÑŸÖŸàŸÇÿπ ŸÖŸÜ ÿµŸÜÿπ BitSamurai.",
                statusErrorUrl: "ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿπŸÜŸàÿßŸÜ URL.",
                statusProcessing: "ÿ¨ÿßÿ±Ÿä ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ±ÿßÿ®ÿ∑... Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±.",
                statusSuccessHeader: "ÿßŸÉÿ™ŸÖŸÑ! ÿßŸÑŸÖŸÑŸÅ (ÿßŸÑŸÖŸÑŸÅÿßÿ™) ÿ¨ÿßŸáÿ≤:",
                statusDownloadButton: "ÿ™ÿ≠ŸÖŸäŸÑ {FORMAT}",
                statusPostDownloadHint: "ÿ•ÿ∞ÿß ŸÑŸÖ Ÿäÿ®ÿØÿ£ ÿßŸÑÿ™ŸÜÿ≤ŸäŸÑÿå ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ ÿ£Ÿà ÿ≠ÿßŸàŸÑ ÿßŸÑŸÜŸÇÿ± ÿ®ÿ≤ÿ± ÿßŸÑŸÖÿßŸàÿ≥ ÿßŸÑÿ£ŸäŸÖŸÜ ŸàÿßÿÆÿ™Ÿäÿßÿ± 'ÿ≠ŸÅÿ∏ ÿßŸÑÿ±ÿßÿ®ÿ∑ ÿ®ÿßÿ≥ŸÖ...'.",
                statusErrorGeneric: "ÿÆÿ∑ÿ£: {MESSAGE}",
                statusNetworkError: "ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ¥ÿ®ŸÉÿ©. ÿßŸÑÿ±ÿ¨ÿßÿ° ŸÖÿπÿßŸàÿØÿ© ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ©.",
                languageLabel: "ÿßŸÑŸÑÿ∫ÿ©:"
            }
        };

        let currentLanguage = 'ru'; 

        function applyTranslations(lang) {
            currentLanguage = lang;
            localStorage.setItem('preferredLanguage', lang); 

            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            document.title = translations[lang].pageTitle;

            document.querySelectorAll('[data-translate-key]').forEach(element => {
                const key = element.getAttribute('data-translate-key');
                if (translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
                const key = element.getAttribute('data-translate-placeholder');
                 if (translations[lang][key]) {
                    element.placeholder = translations[lang][key];
                }
            });
            const langSelector = document.getElementById('languageSelector');
            if (langSelector) {
                langSelector.value = lang;
            }
        }

        function getTranslation(key, lang = currentLanguage, replacements = {}) {
            let text = translations[lang]?.[key] || key; 
            for (const placeholder in replacements) {
                text = text.replace(`{${placeholder}}`, replacements[placeholder]);
            }
            return text;
        }

        document.getElementById('year').textContent = new Date().getFullYear();
        const downloadForm = document.getElementById('downloadForm');
        const statusArea = document.getElementById('statusArea');
        const youtubeUrlInput = document.getElementById('youtube_url');
        const formatChoiceSelect = document.getElementById('format_choice');
        const languageSelector = document.getElementById('languageSelector');

        languageSelector.addEventListener('change', (event) => {
            applyTranslations(event.target.value);
        });

        downloadForm.addEventListener('submit', async function(event) {
            event.preventDefault();
            const url = youtubeUrlInput.value.trim();
            const format = formatChoiceSelect.value;

            if (!url) {
                statusArea.innerHTML = `<p class="text-red-400 p-3 bg-red-900/30 rounded-md">${getTranslation('statusErrorUrl')}</p>`;
                return;
            }
             try {
                new URL(url);
                if (!url.includes('youtube.com/') && !url.includes('youtu.be/') && !url.includes('m.youtube.com') && !url.includes('youtu.be')) {
                }
            } catch (_) {
                statusArea.innerHTML = `<p class="text-red-400 p-3 bg-red-900/30 rounded-md">${getTranslation('statusErrorUrl')}</p>`;
                return;
            }

            statusArea.innerHTML = `
                <div class="flex flex-col justify-center items-center space-y-2 text-sky-400 p-3">
                    <div class="loader ease-linear rounded-full border-4 border-t-4 border-slate-600 h-8 w-8 mb-2"></div>
                    <span>${getTranslation('statusProcessing')}</span>
                </div>`;

            const submitButton = this.querySelector('button[type="submit"]');
            submitButton.disabled = true;
            submitButton.classList.add('opacity-50', 'cursor-not-allowed');

            try {
                const response = await fetch('/api/download_audio', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: url, format: format }),
                });

                const contentType = response.headers.get("content-type");
                if (!contentType || !contentType.includes("application/json")) {
                    const errorText = await response.text();
                    throw new Error(`Server returned an unexpected response: ${response.status} ${response.statusText}. ${errorText.substring(0,100)}`);
                }
                const data = await response.json();

                if (response.ok && data.status === 'success' && data.files && data.files.length > 0) {
                    let filesHtml = data.files.map(fileInfo => `
                        <li class="bg-slate-700 p-3 rounded-md shadow hover:shadow-md transition-shadow duration-150">
                            <span class="text-slate-300 block truncate" title="${fileInfo.title || ''}">${fileInfo.title || 'Untitled'}</span>
                            <a href="${fileInfo.download_url}"
                               target="_blank" rel="noopener noreferrer"
                               download="${fileInfo.filename || ''}"
                               class="inline-block mt-2 bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-md text-sm transition duration-150 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50">
                               ${getTranslation('statusDownloadButton', currentLanguage, {FORMAT: (fileInfo.filename ? fileInfo.filename.split('.').pop().toUpperCase() : format.toUpperCase())})}
                            </a>
                        </li>
                    `).join('');

                    statusArea.innerHTML = `
                        <p class="text-green-400 mb-3 text-lg">${getTranslation('statusSuccessHeader')}</p>
                        <ul class="space-y-3 text-left max-h-60 overflow-y-auto">${filesHtml}</ul>
                        <p class="text-xs text-slate-500 mt-4">${getTranslation('statusPostDownloadHint')}</p>
                    `;
                    (async () => {
                        for (let i = 0; i < data.files.length; i++) {
                            const fileInfo = data.files[i];
                            const link = document.createElement('a');
                            link.href = fileInfo.download_url;
                            link.download = fileInfo.filename || `audio_download.${fileInfo.download_url.split('.').pop()}`;
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            if (i < data.files.length - 1) {
                                await new Promise(resolve => setTimeout(resolve, 1000)); 
                            }
                        }
                    })();

                } else {
                    statusArea.innerHTML = `<p class="text-red-400 p-3 bg-red-900/30 rounded-md">${getTranslation('statusErrorGeneric', currentLanguage, {MESSAGE: (data.message || 'Could not download audio.')})}</p>`;
                }
            } catch (error) {
                console.error('Fetch error:', error);
                statusArea.innerHTML = `<p class="text-red-400 p-3 bg-red-900/30 rounded-md">${getTranslation('statusNetworkError')} (${error.message})</p>`;
            } finally {
                submitButton.disabled = false;
                submitButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        });

        const preferredLang = localStorage.getItem('preferredLanguage');
        const browserLang = navigator.language.split('-')[0]; 

        if (preferredLang && translations[preferredLang]) {
            applyTranslations(preferredLang);
        } else if (translations[browserLang]) {
            applyTranslations(browserLang);
        } else {
            applyTranslations('ru'); 
        }
    </script>
</body>
</html>
